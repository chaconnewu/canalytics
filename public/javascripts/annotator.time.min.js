/*
** Annotator 1.2.5-dev-b83d51d
** https://github.com/okfn/annotator/
**
** Copyright 2012 Aron Carroll, Rufus Pollock, and Nick Stenning.
** Dual licensed under the MIT and GPLv3 licenses.
** https://github.com/okfn/annotator/blob/master/LICENSE
**
** Built at: 2012-11-07 04:40:45Z
*/(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};Annotator.Plugin.Time=function(t){function r(){return this.setAnnotationEnd=e(this.setAnnotationEnd,this),this.setAnnotationStart=e(this.setAnnotationStart,this),this.updateField2=e(this.updateField2,this),this.updateField1=e(this.updateField1,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.options={parseTime:function(e){var t;return e===null?!1:(t=/^([0]\d|[1][0-2])\/([0-2]\d|[3][0-1])\/([2][01]|[1][6-9])\d{2}(\s((([0]?[1-9]|1[0-2])(:|\.)[0-5][0-9]((:|\.)[0-5][0-9])?( )?(AM|am|aM|Am|PM|pm|pM|Pm))|(([0]?[0-9]|1[0-9]|2[0-3])(:|\.)[0-5][0-9]((:|\.)[0-5][0-9])?)))?$/,t.test(e))},stringifyTime:function(e){return e}},r.prototype.field=null,r.prototype.input=null,r.prototype.pluginInit=function(){if(!Annotator.supported())return;return this.field1=this.annotator.editor.addField({type:"datetime",label:Annotator._t("From"),load:this.updateField1,submit:this.setAnnotationStart}),this.field2=this.annotator.editor.addField({type:"datetime",label:Annotator._t("To"),load:this.updateField2,submit:this.setAnnotationEnd}),this.annotator.viewer.addField({load:this.updateViewer}),this.input1=$(this.field1).find(":input"),this.input2=$(this.field2).find(":input"),this.annotator.subscribe("annotationEditorShown",this.loadTime),this.annotator.subscribe("annotationEditorSubmit",this.updateTime)},r.prototype.parseTime=function(e){return this.options.parseTime(e)},r.prototype.stringifyTime=function(e){return this.options.stringifyTime(e)},r.prototype.loadTime=function(e,t){return t.oldstart=t.start,t.oldend=t.end},r.prototype.updateTime=function(e,t){var n,r,i,s,o,u,a,f,l;if(!t.start)return t.end=null;f=new Date(t.start);if(t.start!==t.oldstart){if(t.end!=null){s=new Date(t.end);if(f>=s){s.setTime(f.valueOf()+36e5),a=s.getMonth()+1,n=s.getDate(),l=s.getFullYear(),o=s.getHours(),u=s.getMinutes(),o=""+o;while(o.length<2)o="0"+o;u=""+u;while(u.length<2)u="0"+u;i=a+"/"+n+"/"+l+" "+o+":"+u,t.end=i}}else{s=new Date(t.start),s.setTime(f.valueOf()+36e5),a=s.getMonth()+1,n=s.getDate(),l=s.getFullYear(),o=s.getHours(),u=s.getMinutes(),o=""+o;while(o.length<2)o="0"+o;u=""+u;while(u.length<2)u="0"+u;i=a+"/"+n+"/"+l+" "+o+":"+u,t.end=i}return t.eid?(scheduler.getEvent(t.eid).start_date=f,scheduler.getEvent(t.eid).end_date=s,scheduler.updateEvent(t.eid)):(r=scheduler.addEvent(t.start,t.end,t.text,geid,{location:t.location||""}),geid++,t.eid=r)}if(t.end!=null&&t.end!==t.oldend){s=new Date(t.end);if(f>=s){s.setTime(f.valueOf()+36e5),a=s.getMonth()+1,n=s.getDate(),l=s.getFullYear(),o=s.getHours(),u=s.getMinutes(),o=""+o;while(o.length<2)o="0"+o;u=""+u;while(u.length<2)u="0"+u;i=a+"/"+n+"/"+l+" "+o+":"+u,t.end=i}return t.eid?(scheduler.getEvent(t.eid).start_date=f,scheduler.getEvent(t.eid).end_date=s,scheduler.updateEvent(t.eid)):(r=scheduler.addEvent(t.start,t.end,t.text,geid,{location:t.location||""}),geid++,t.eid=r)}},r.prototype.updateField1=function(e,t){var n;return n="",t.start&&(n=this.stringifyTime(t.start)),this.input1.val(n)},r.prototype.updateField2=function(e,t){var n;return n="",t.end&&(n=this.stringifyTime(t.end)),this.input2.val(n)},r.prototype.setAnnotationStart=function(e,t){var n;n=this.parseTime(this.input1.val());if(n)return t.start=this.input1.val()},r.prototype.setAnnotationEnd=function(e,t){var n;n=this.parseTime(this.input2.val());if(n)return t.end=this.input2.val()},r.prototype.updateViewer=function(e,t){return e=$(e),t.start?e.addClass("annotator-datetime").html('<span class="annotator-datetime"><a href="javascript:scheduler.showEvent('+t.eid+')">'+Annotator.$.escape(t.start)+"<br>"+"-"+Annotator.$.escape(t.end)+"</a></span>"):e.remove()},r}(Annotator.Plugin)}).call(this);